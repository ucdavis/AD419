CREATE VIEW dbo.AllPPSExpensesFor204Projects_V
AS
	  
SELECT DISTINCT TOP (100000) LaborTransactionId, Chart, Account, SubAccount, Org, ObjConsol, Object,	FinanceDocTypeCd, DOSCd, EmployeeID, EmployeeName, POSITION_NBR, EFFDT, RateTypeCd, Hours, Amount, Payrate, CalculatedFTE, PayPeriodEndDate, FringeBenefitSalaryCd, AnnualReportCode, ReportingYear, OrgId
      FROM  (
	  SELECT * 
	  FROM OPENQUERY ([FIS_BISTG_PRD (CAES_HCMODS_APPUSER)],'
	   SELECT 
			t1.JOURNAL_ID || ''-'' || 
			t1.JOURNAL_LINE || ''-'' || 
			t1.UC_ADDL_SEQ || ''-'' || 
			t1.POSITION_NBR "LaborTransactionId",
			t1.OPERATING_UNIT "Chart",
			SUBSTR(DEPTID_CF, 3, 7) "Account",
			CLASS_FLD "SubAccount",
			SUBSTR(UC_DEPTID_ROLLUP, 3, 4) "Org",
			t2.FIN_CONS_OBJ_CD  "ObjConsol",
			SUBSTR(ACCOUNT,4, 4) "Object",
			''PAY'' FinanceDocTypeCd,
			''XXX'' "DOSCd",
			t1.EMPLID "EmployeeID",
			'''' EmployeeName,	-- Need to include this as the field can''t be null.
			t1.POSITION_NBR,
			t1.EFFDT,
			''H'' "RateTypeCd",	-- Need to include this as the field can''t be null.
			0 "Hours",
			MONETARY_AMOUNT "Amount",
			0 "Payrate",
			0 "CalculatedFTE",
			UC_EARN_END_DT "PayPeriodEndDate",
			''F'' "FringeBenefitSalaryCd",
			--t2.ANNUAL_REPORT_CODE "AnnualReportCode", 
			--0 AS "ExcludedByARC",
			2020 "ReportingYear"
			--t2.ORG_ID OrgId
		
		FROM CAES_HCMODS.PS_UC_LL_FRNG_DTL_V t1
		INNER JOIN CAES_HCMODS.UCD_OBJECT_CODES_V t2 ON 
			SUBSTR(t1.ACCOUNT,3,4) = t2.FIN_OBJECT_CD AND 
			t1.OPERATING_UNIT = t2.FIN_COA_CD AND 
			t1.Fiscal_Year = t2.UNIV_FISCAL_YR 
		WHERE OPERATING_UNIT IN (''3'',''L'') AND
			(
			(t1.FISCAL_YEAR = 2020  AND t1.ACCOUNTING_PERIOD BETWEEN 4 AND 13) OR
			(t1.FISCAL_YEAR = 2021  AND t1.ACCOUNTING_PERIOD BETWEEN 1 AND 3) 
			) AND
			t1.BUSINESS_UNIT IN (''DVCMP'',''UCANR'') AND
			t1.DML_IND <> ''D'' AND
			SUBSTR(t1.ACCOUNT,3,4) NOT IN (''INC0'', ''BLSH'', ''SB74'', ''SUB9'') AND
			DEPTID_CF IN (
''3-AEXNPDN'',''3-ALVCOMP'',''3-ALVEXPL'',''3-ALVGCLS'',''3-ANSATJH'',''3-APOROOT'',''3-APSF0FF'',''3-APSF445'',''3-APSF502'',''3-APSF519'',''3-APSF527'',''3-APSF546'',''3-APSF551'',''3-APSF559'',''3-APSF565'',''3-APSF581'',''3-APSF583'',''3-APSF630'',''3-APSF644'',''3-APSF645'',''3-APSF680'',''3-APSF695'',''3-APSF696'',''3-APSF697'',''3-APSF702'',''3-APSF703'',
''3-APSF708'',''3-APSF709'',''3-APSF712'',''3-APSF718'',''3-APSF720'',''3-APSF737'',''3-APSF738'',''3-APSF744'',''3-APSF746'',''3-APSF748'',''3-APSF749'',''3-APSF750'',''3-APSF752'',''3-APSF753'',''3-APSF758'',''3-APSF760'',''3-APSF761'',''3-APSF837'',''3-APSF842'',''3-APSF852'',''3-APSF853'',''3-APSF854'',''3-APSF867'',''3-APSF875'',''3-APSF876'',''3-APSF897'',
''3-APSF903'',''3-APSF904'',''3-APSF906'',''3-APSF910'',''3-APSF911'',''3-APSF912'',''3-APSF913'',''3-APSF914'',''3-APSF915'',''3-APSF916'',''3-APSF917'',''3-APSF918'',''3-APSF919'',''3-APSF920'',''3-APSF921'',''3-APSF922'',''3-APSF923'',''3-APSF924'',''3-APSF925'',''3-APSF926'',''3-APSF927'',''3-APSF928'',''3-APSF942'',''3-APSF950'',''3-APSF960'',''3-APSF964'',
''3-APSF977'',''3-APSF982'',''3-APSF987'',''3-APSF992'',''3-APSF9AR'',''3-APSF9CP'',''3-APSF9RV'',''3-APSF9SC'',''3-APSF9UF'',''3-APSFA05'',''3-APSJ546'',''3-APSJ964'',''3-APSJ977'',''3-APSJ992'',''3-AXOSCRI'',''3-AYT0385'',''3-BBRICE1'',''3-BWF2176'',''3-BWF2177'',''3-CHLSCRI'',''3-CLSNPDN'',''3-CRFCDRE'',''3-CXN0442'',''3-CXN0580'',''3-CXN0581'',''3-CXN2C52'',
''3-CXN3C99'',''3-DAN1559'',''3-DANFINA'',''3-DAS5INS'',''3-DCSHTPP'',''3-DCSSCRI'',''3-DEU0132'',''3-DEU0133'',''3-DEU0456'',''3-DEU0636'',''3-DNM2327'',''3-DNM2503'',''3-DNM2584'',''3-DNM2614'',''3-DNM2615'',''3-DNM2616'',''3-DNM2617'',''3-DNM2618'',''3-DNM2619'',''3-DNM2620'',''3-DNM2621'',''3-DNM2622'',''3-DNM2623'',''3-DNM2624'',''3-DNM2625'',''3-DNM7C83'',
''3-EAMGENE'',''3-EAMTARC'',''3-EJAUSDA'',''3-ELD3C00'',''3-ELD7B44'',''3-EXN0440'',''3-EXN6B55'',''3-FAF7C66'',''3-FAFADVA'',''3-FAFAGRI'',''3-FCM5INF'',''3-FGZSCRI'',''3-FINAGEN'',''3-FINANNF'',''3-FPTNPDN'',''3-GEIS798'',''3-GENMPJR'',''3-GF1USDA'',''3-GF1USPS'',''3-GF87B44'',''3-GLC2194'',''3-GLC2382'',''3-GLC2383'',''3-GLC2414'',''3-GLC2415'',''3-GLC2597'',
''3-GLC7C83'',''3-GLCFLOR'',''3-GLCTAMU'',''3-GLCUCR1'',''3-GLCUSDA'',''3-GMBEAGR'',''3-GMBNIFA'',''3-GMYF031'',''3-GSUSDA1'',''3-HJZFKIM'',''3-HJZGENO'',''3-HJZGENP'',''3-HJZKERN'',''3-HJZKETE'',''3-HJZKETF'',''3-HJZTHKE'',''3-HJZTHKF'',''3-HJZTKIM'',''3-HJZWIDE'',''3-HORW536'',''3-HORW552'',''3-HXCJWAS'',''3-IMG3C99'',''3-IPCON19'',''3-IR419DD'',''3-IR419EE'',
''3-IR419FF'',''3-IR419GG'',''3-IR419HH'',''3-IR42015'',''3-IR42016'',''3-IR42017'',''3-IR42018'',''3-IR42019'',''3-IR4CNSL'',''3-IR4PART'',''3-JAR0374'',''3-JAR37C4'',''3-JAR37C5'',''3-JAR39C2'',''3-JAR39C3'',''3-JDMTRNS'',''3-JHL2073'',''3-JIN2428'',''3-JMA5AIP'',''3-JWONIFA'',''3-KAR4316'',''3-KIMNIFA'',''3-KIS0619'',''3-KKJ5CCR'',''3-KLBLIG1'',''3-KMJ3MDH'',
''3-KMKBOTS'',''3-KMMFINA'',''3-KMMNIFA'',''3-KVS2150'',''3-LJB5CCR'',''3-LJHFC00'',''3-LJHFENG'',''3-LXWFC00'',''3-MHEAGER'',''3-MLMGARM'',''3-MLMLACT'',''3-MLMSBMG'',''3-MLMSBMP'',''3-MPP0349'',''3-MSTNIF2'',''3-MSTNIF3'',''3-MSTNIF4'',''3-MSTNIF5'',''3-MSTNIFA'',''3-MSTPTCS'',''3-NMW5C12'',''3-NNN3157'',''3-NNNF031'',''3-NNNNIFA'',''3-NNNPART'',''3-NNNSCRI'',
''3-NT1USDA'',''3-PAR0151'',''3-PCR2519'',''3-PJBNIFA'',''3-PJRGENM'',''3-PJRUSDA'',''3-PRFAANG'',''3-RCHNIFA'',''3-REG5KNA'',''3-REG5SCR'',''3-REGSCRI'',''3-RESCAT1'',''3-RESNNF1'',''3-RLG3C99'',''3-RM00357'',''3-RMB2374'',''3-RMFINAW'',''3-RMKFINA'',''3-RMSCRI2'',''3-RMUSDAW'',''3-RRHOOIL'',''3-SCOW893'',''3-SGVFRAI'',''3-SGVMDLE'',''3-SGVPLAT'',''3-SKKSCRI'',
''3-SUN0385'',''3-SUNPART'',''3-TAEHKIM'',''3-TJM2337'',''3-TJM2586'',''3-TJM3C99'',''3-TJM6B55'',''3-TJZKAWA'',''3-TJZLIG1'',''3-TJZSCOT'',''3-TKB5SIS'',''3-TRAIN18'',''3-TRG5B38'',''3-VHD1POC'',''3-VSK5USD'',''3-WFCSSLC'',''L-APSF011'')

') t1

UNION ALL

  SELECT  * 
  FROM OPENQUERY ([FIS_BISTG_PRD (CAES_HCMODS_APPUSER)],'
		SELECT t1.JOURNAL_ID || ''-'' || 
				t1.JOURNAL_LINE || ''-'' || 
				t1.UC_ADDL_SEQ || ''-'' || 
				t1.POSITION_NBR "LaborTransactionId",
			OPERATING_UNIT "Chart",
			SUBSTR(DEPTID_CF,3, 7) "Account",
			CLASS_FLD "SubAccount",
			SUBSTR(UC_DEPTID_ROLLUP,3, 4) "Org",
			t2.FIN_CONS_OBJ_CD "ObjConsol",
			SUBSTR(ACCOUNT,3,4) Object,
			''PAY'' "FinanceDocTypeCd",
			ERNCD "DOSCd",
			t1.EMPLID "EmployeeID",
			'''' EmployeeName,	-- Need to include this as the field can''t be null.
			t1.POSITION_NBR,
			t1.EFFDT,
			''H'' "RateTypeCd",	-- Need to include this as the field can''t be null.
			Hours1 "Hours",
			MONETARY_AMOUNT "Amount",
			CASE WHEN Hours1 <> 0 THEN round(MONETARY_AMOUNT/Hours1, 3) ELSE 0 END "Payrate",
			CASE WHEN Hours1 <> 0 THEN ROUND(hours1/2088, 6) ELSE 0 END "CalculatedFTE",
			UC_EARN_END_DT "PayPeriodEndDate",
			''S'' "FringeBenefitSalaryCd",
			--t2.ANNUAL_REPORT_CODE "AnnualReportCode", 
			--0 AS "ExcludedByARC",
			2020 "ReportingYear"
			--t2.ORG_ID "OrgId" 

			FROM CAES_HCMODS.PS_UC_LL_SAL_DTL_V t1
			INNER JOIN CAES_HCMODS.UCD_OBJECT_CODES_V t2 ON 
				SUBSTR(t1.ACCOUNT,3,4) = t2.FIN_OBJECT_CD AND 
				t1.OPERATING_UNIT = t2.FIN_COA_CD AND 
				t1.Fiscal_Year = t2.UNIV_FISCAL_YR 
			WHERE OPERATING_UNIT IN (''3'',''L'') AND
				(
				(t1.FISCAL_YEAR = 2020  AND t1.ACCOUNTING_PERIOD BETWEEN 4 AND 13) OR
				(t1.FISCAL_YEAR = 2021  AND t1.ACCOUNTING_PERIOD BETWEEN 1 AND 3) 
				) AND
				t1.BUSINESS_UNIT IN (''DVCMP'',''UCANR'') AND
				t1.DML_IND <> ''D'' AND
				SUBSTR(t1.ACCOUNT,3,4) NOT IN (''INC0'', ''BLSH'', ''SB74'', ''SUB9'')  AND
				DEPTID_CF IN (''3-AEXNPDN'',''3-ALVCOMP'',''3-ALVEXPL'',''3-ALVGCLS'',''3-ANSATJH'',''3-APOROOT'',''3-APSF0FF'',''3-APSF445'',''3-APSF502'',''3-APSF519'',''3-APSF527'',''3-APSF546'',''3-APSF551'',''3-APSF559'',''3-APSF565'',''3-APSF581'',''3-APSF583'',''3-APSF630'',''3-APSF644'',''3-APSF645'',''3-APSF680'',''3-APSF695'',''3-APSF696'',''3-APSF697'',''3-APSF702'',''3-APSF703'',
''3-APSF708'',''3-APSF709'',''3-APSF712'',''3-APSF718'',''3-APSF720'',''3-APSF737'',''3-APSF738'',''3-APSF744'',''3-APSF746'',''3-APSF748'',''3-APSF749'',''3-APSF750'',''3-APSF752'',''3-APSF753'',''3-APSF758'',''3-APSF760'',''3-APSF761'',''3-APSF837'',''3-APSF842'',''3-APSF852'',''3-APSF853'',''3-APSF854'',''3-APSF867'',''3-APSF875'',''3-APSF876'',''3-APSF897'',
''3-APSF903'',''3-APSF904'',''3-APSF906'',''3-APSF910'',''3-APSF911'',''3-APSF912'',''3-APSF913'',''3-APSF914'',''3-APSF915'',''3-APSF916'',''3-APSF917'',''3-APSF918'',''3-APSF919'',''3-APSF920'',''3-APSF921'',''3-APSF922'',''3-APSF923'',''3-APSF924'',''3-APSF925'',''3-APSF926'',''3-APSF927'',''3-APSF928'',''3-APSF942'',''3-APSF950'',''3-APSF960'',''3-APSF964'',
''3-APSF977'',''3-APSF982'',''3-APSF987'',''3-APSF992'',''3-APSF9AR'',''3-APSF9CP'',''3-APSF9RV'',''3-APSF9SC'',''3-APSF9UF'',''3-APSFA05'',''3-APSJ546'',''3-APSJ964'',''3-APSJ977'',''3-APSJ992'',''3-AXOSCRI'',''3-AYT0385'',''3-BBRICE1'',''3-BWF2176'',''3-BWF2177'',''3-CHLSCRI'',''3-CLSNPDN'',''3-CRFCDRE'',''3-CXN0442'',''3-CXN0580'',''3-CXN0581'',''3-CXN2C52'',
''3-CXN3C99'',''3-DAN1559'',''3-DANFINA'',''3-DAS5INS'',''3-DCSHTPP'',''3-DCSSCRI'',''3-DEU0132'',''3-DEU0133'',''3-DEU0456'',''3-DEU0636'',''3-DNM2327'',''3-DNM2503'',''3-DNM2584'',''3-DNM2614'',''3-DNM2615'',''3-DNM2616'',''3-DNM2617'',''3-DNM2618'',''3-DNM2619'',''3-DNM2620'',''3-DNM2621'',''3-DNM2622'',''3-DNM2623'',''3-DNM2624'',''3-DNM2625'',''3-DNM7C83'',
''3-EAMGENE'',''3-EAMTARC'',''3-EJAUSDA'',''3-ELD3C00'',''3-ELD7B44'',''3-EXN0440'',''3-EXN6B55'',''3-FAF7C66'',''3-FAFADVA'',''3-FAFAGRI'',''3-FCM5INF'',''3-FGZSCRI'',''3-FINAGEN'',''3-FINANNF'',''3-FPTNPDN'',''3-GEIS798'',''3-GENMPJR'',''3-GF1USDA'',''3-GF1USPS'',''3-GF87B44'',''3-GLC2194'',''3-GLC2382'',''3-GLC2383'',''3-GLC2414'',''3-GLC2415'',''3-GLC2597'',
''3-GLC7C83'',''3-GLCFLOR'',''3-GLCTAMU'',''3-GLCUCR1'',''3-GLCUSDA'',''3-GMBEAGR'',''3-GMBNIFA'',''3-GMYF031'',''3-GSUSDA1'',''3-HJZFKIM'',''3-HJZGENO'',''3-HJZGENP'',''3-HJZKERN'',''3-HJZKETE'',''3-HJZKETF'',''3-HJZTHKE'',''3-HJZTHKF'',''3-HJZTKIM'',''3-HJZWIDE'',''3-HORW536'',''3-HORW552'',''3-HXCJWAS'',''3-IMG3C99'',''3-IPCON19'',''3-IR419DD'',''3-IR419EE'',
''3-IR419FF'',''3-IR419GG'',''3-IR419HH'',''3-IR42015'',''3-IR42016'',''3-IR42017'',''3-IR42018'',''3-IR42019'',''3-IR4CNSL'',''3-IR4PART'',''3-JAR0374'',''3-JAR37C4'',''3-JAR37C5'',''3-JAR39C2'',''3-JAR39C3'',''3-JDMTRNS'',''3-JHL2073'',''3-JIN2428'',''3-JMA5AIP'',''3-JWONIFA'',''3-KAR4316'',''3-KIMNIFA'',''3-KIS0619'',''3-KKJ5CCR'',''3-KLBLIG1'',''3-KMJ3MDH'',
''3-KMKBOTS'',''3-KMMFINA'',''3-KMMNIFA'',''3-KVS2150'',''3-LJB5CCR'',''3-LJHFC00'',''3-LJHFENG'',''3-LXWFC00'',''3-MHEAGER'',''3-MLMGARM'',''3-MLMLACT'',''3-MLMSBMG'',''3-MLMSBMP'',''3-MPP0349'',''3-MSTNIF2'',''3-MSTNIF3'',''3-MSTNIF4'',''3-MSTNIF5'',''3-MSTNIFA'',''3-MSTPTCS'',''3-NMW5C12'',''3-NNN3157'',''3-NNNF031'',''3-NNNNIFA'',''3-NNNPART'',''3-NNNSCRI'',
''3-NT1USDA'',''3-PAR0151'',''3-PCR2519'',''3-PJBNIFA'',''3-PJRGENM'',''3-PJRUSDA'',''3-PRFAANG'',''3-RCHNIFA'',''3-REG5KNA'',''3-REG5SCR'',''3-REGSCRI'',''3-RESCAT1'',''3-RESNNF1'',''3-RLG3C99'',''3-RM00357'',''3-RMB2374'',''3-RMFINAW'',''3-RMKFINA'',''3-RMSCRI2'',''3-RMUSDAW'',''3-RRHOOIL'',''3-SCOW893'',''3-SGVFRAI'',''3-SGVMDLE'',''3-SGVPLAT'',''3-SKKSCRI'',
''3-SUN0385'',''3-SUNPART'',''3-TAEHKIM'',''3-TJM2337'',''3-TJM2586'',''3-TJM3C99'',''3-TJM6B55'',''3-TJZKAWA'',''3-TJZLIG1'',''3-TJZSCOT'',''3-TKB5SIS'',''3-TRAIN18'',''3-TRG5B38'',''3-VHD1POC'',''3-VSK5USD'',''3-WFCSSLC'',''L-APSF011'')

	') t2
	) t1
	 INNER JOIN 
	  (
		SELECT CHART_NUM, ACCT_NUM, ANNUAL_REPORT_CODE "AnnualReportCode", ORG_ID "OrgId"
		FROM OPENQUERY([FIS_DS], '
			SELECT A.CHART_NUM, A.ACCT_NUM, A.ANNUAL_REPORT_CODE, A.ORG_ID 
			FROM FINANCE.ORGANIZATION_ACCOUNT A
			WHERE A.FISCAL_YEAR = 9999 AND 
				A.FISCAL_PERIOD = ''--'' AND
				A.HIGHER_ED_FUNC_CODE NOT LIKE ''PROV'' 
		')
	   ) t2 ON t1.Chart = t2.CHART_NUM AND t1.Account = t2.ACCT_NUM

	ORDER BY LaborTransactionId